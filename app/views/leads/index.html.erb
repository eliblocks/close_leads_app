<h1>Smartview Leads</h1>

<table id="leadsTable">
  <thead>
    <tr>
      <th>
        Name<br>
        <input type="text" id="filterName" onkeyup="filterTable()" placeholder="Filter by name">
      </th>
      <th>
        Status<br>
        <input type="text" id="filterStatus" onkeyup="filterTable()" placeholder="Filter by status">
      </th>
      <th>Kunde</th>
      <th>Created</th>
      <th>View in Close</th>
    </tr>
  </thead>
  <tbody>
    <% @leads.each do |lead| %>
    <tr>
      <td><%= lead['name'] %></td>
      <td><%= lead['status_label'] %></td>
      <td><%= lead['custom.cf_K3ausfM3pWXa7CAMQIpWV0eV7Dqc2IXIuOpiX4Luqa9'] %></td>
      <td><%= DateTime.parse(lead['date_created']).strftime('%Y-%m-%d') %></td>
      <td><a href="https://app.close.com/lead/<%= lead['id'] %>" target="_blank">View in Close</a></td>
    </tr>
    <% end %>
  </tbody>
</table>

<script>
  function filterTable() {
    const nameFilter = document.getElementById('filterName').value.toLowerCase();
    const statusFilter = document.getElementById('filterStatus').value.toLowerCase();
    const table = document.getElementById('leadsTable');
    const rows = table.querySelectorAll('tbody tr');

    rows.forEach(row => {
      const nameCell = row.cells[0].textContent.toLowerCase();
      const statusCell = row.cells[1].textContent.toLowerCase();
      const nameMatches = nameCell.includes(nameFilter);
      const statusMatches = statusCell.includes(statusFilter);

      if (nameMatches && statusMatches) {
        row.style.display = '';
      } else {
        row.style.display = 'none';
      }
    });
  }
</script>
